<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>分类树结构可视化</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: "Microsoft YaHei", "SimHei", sans-serif;
            margin: 0;
            padding: 20px;
        }
        .node rect {
            fill: white;
            stroke: #333;
            stroke-width: 1px;
            rx: 5;
            ry: 5;
        }
        .node text {
            font: 12px sans-serif;
        }
        .link {
            fill: none;
            stroke: #555;
            stroke-width: 1px;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        #tree-container {
            width: 100%;
            height: 800px;
            overflow: auto;
        }
        .detail-text {
            font-size: 10px;
            fill: #666;
        }
    </style>
</head>
<body>
    <h1>分类树结构可视化</h1>
    <div id="tree-container"></div>

    <script>
        // 加载数据
        fetch('classification_tree.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error('无法加载JSON文件，状态码: ' + response.status);
                }
                return response.json();
            })
            .then(data => {
                console.log('成功加载数据:', data);
                createVisualization(data);
            })
            .catch(error => {
                console.error('加载数据出错:', error);
                document.getElementById('tree-container').innerHTML = 
                    '<p style="color:red">加载数据失败: ' + error.message + 
                    '<br>请确保classification_tree.json文件在同一目录下<br>或尝试使用Python启动本地服务器: python -m http.server</p>';
            });

        function createVisualization(treeData) {
            // 设置画布尺寸
            const width = 1800;
            const height = 1200;
            
            // 清除之前的内容
            d3.select("#tree-container").html("");
            
            // 创建SVG元素
            const svg = d3.select("#tree-container").append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", "translate(80,0)");
            
            // 创建树形布局 - 使用水平布局
            const treeLayout = d3.tree()
                .size([height, width - 300])
                .separation((a, b) => (a.parent == b.parent ? 1.2 : 1.5));
            
            // 创建层次结构
            const root = d3.hierarchy(treeData);
            
            // 计算节点位置
            treeLayout(root);
            
            // 添加连接线
            svg.selectAll(".link")
                .data(root.links())
                .enter().append("path")
                .attr("class", "link")
                .attr("d", d3.linkHorizontal()
                    .x(d => d.y)
                    .y(d => d.x));
            
            // 添加节点组
            const node = svg.selectAll(".node")
                .data(root.descendants())
                .enter().append("g")
                .attr("class", "node")
                .attr("transform", d => `translate(${d.y},${d.x})`);
            
            // 为节点添加矩形框
            node.append("rect")
                .attr("width", d => Math.max(d.data.name.length * 14, 60))
                .attr("height", 30)
                .attr("x", -10)
                .attr("y", -15)
                .attr("rx", 5)
                .attr("ry", 5);
            
            // 添加节点文本
            node.append("text")
                .attr("dy", ".3em")
                .attr("text-anchor", "middle")
                .attr("dominant-baseline", "middle")
                .text(d => d.data.name);
            
            // 为有子节点的节点添加详细信息文本（模拟图片中的描述文本）
            node.filter(d => d.children && d.children.length > 0)
                .selectAll(".detail-text")
                .data(d => {
                    // 为每个子节点创建一个描述文本
                    return d.children.map(child => {
                        return {
                            name: child.data.name,
                            x: d.y + 20,
                            y: (child.x - d.x) * 0.5 + d.x
                        };
                    });
                })
                .enter()
                .append("text")
                .attr("class", "detail-text")
                .attr("x", d => 100)
                .attr("y", (d, i) => i * 12 - 15)
                .text(d => d.name);
        }
    </script>
</body>
</html>